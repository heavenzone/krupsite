---
title: 学做雷达图
author: Heaven Zone
date: '2018-03-28'
slug: learn-to-make-a-radar-plot
categories:
  - R
tags:
  - R
  - 雷达图
  - 可视化
---



<div class="section level1">
<h1>数据</h1>
<pre class="r"><code>library(tidyverse)
library(scales)
library(showtext)
showtext_auto()
df &lt;- data.frame(语文 = c(50, 60, 70, 90),
                   姓名 = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;),
                   数学 = c(55, 60, 80, 90),
                   英语 = c(80, 60, 70, 77))
df</code></pre>
<pre><code>##   语文 姓名 数学 英语
## 1   50    A   55   80
## 2   60    B   60   60
## 3   70    C   80   70
## 4   90    D   90   77</code></pre>
</div>
<div id="ggradarggradar" class="section level1">
<h1>用ggradar::ggradar()做雷达图</h1>
<p>ggradar用的是ggplot2做图。</p>
<pre class="r"><code>df.new &lt;- df %&gt;% mutate_if(is.numeric, rescale) %&gt;%
  select(姓名, everything())
ggradar::ggradar(df.new)</code></pre>
<p><img src="/post/2018-03-28-learn-to-make-a-radar-plot_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="fmsb" class="section level1">
<h1>用fmsb做雷达图</h1>
<p>fmsb用的是基础做图。</p>
<pre class="r"><code>fmsb_df &lt;- function(df) {
  dfmax &lt;- apply(df, 2, max)
  dfmin &lt;- apply(df, 2, min) 
  as.data.frame(rbind(dfmax, dfmin, df))
}
df %&gt;% select(-姓名) %&gt;% fmsb_df() %&gt;%
fmsb::radarchart(seg = 5, plty = 1:4, plwd = 4, pcol = rainbow(4))
legend(&quot;topright&quot;, legend = df$姓名, lty = 1:4, col = rainbow(4))</code></pre>
<p><img src="/post/2018-03-28-learn-to-make-a-radar-plot_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="ggplot" class="section level1">
<h1>用ggplot</h1>
<pre class="r"><code>library(ggplot2)
library(tidyverse)

coord_radar &lt;- function (theta = &quot;x&quot;, start = 0, direction = 1) {
  # http://www.cmap.polytechnique.fr/~lepennec/R/Radar/RadarAndParallelPlots.html
  theta &lt;- match.arg(theta, c(&quot;x&quot;, &quot;y&quot;))
  r &lt;- if (theta == &quot;x&quot;) 
    &quot;y&quot;
  else &quot;x&quot;
  ggproto(&quot;CoordRadar&quot;, CoordPolar, theta = theta, r = r, start = start, 
          direction = sign(direction),
          is_linear = function(coord) TRUE)
}

hg_get_colname &lt;- function(df, col) {
  if(is.numeric(col)) {
    colnames(df)[col]
  } else {
    tmp &lt;- colnames(df)[colnames(df) %in% col]
    if(length(tmp) == 0) {
      stop(&quot;no that colname&quot;)
    } else {
      tmp
    }
  }
}

hg_gg_radar_long &lt;- function(df, 
                              group_col = 1, 
                              variable_col = 2, 
                              value_col = 3,
                              filter = NULL
                              ) {
  group &lt;- hg_get_colname(df, group_col)
  variable &lt;- hg_get_colname(df, variable_col)
  value &lt;- hg_get_colname(df, value_col)
  colnames(df)[colnames(df) == group] &lt;- &quot;group&quot;
  colnames(df)[colnames(df) == variable] &lt;- &quot;variable&quot;
  colnames(df)[colnames(df) == value] &lt;- &quot;value&quot;
  df &lt;- df %&gt;% 
    group_by(variable) %&gt;% mutate(value.rescale = rescale(value)) %&gt;%
    ungroup() %&gt;% as.data.frame() 
  if(!is.null(filter)) {
   df &lt;- df %&gt;% dplyr::filter(group %in% filter)
  }
  ggplot(df, aes(x = variable, y = value.rescale, color = group)) +
    geom_point(size=rel(0.9)) +
    geom_polygon(aes(group = group), 
                 data = df, 
                 fill = NA, 
                 size = 1) +
    geom_line(aes(group = group), data = df, size = 1) +
    annotate(&quot;text&quot;,
             x = df[, variable], 
             y = (df[, &quot;value.rescale&quot;]) + 0.08,
             label = round(df[, value], 2), size = 3) +
    theme(strip.text.x = element_text(size = rel(0.8)),
          axis.text.x = element_text(size = rel(1)),
          axis.ticks.y = element_blank(),
          panel.grid.minor = element_blank(),
          axis.text.y = element_blank()) +
    scale_y_continuous(limits = c(0, 1.05)) +
    xlab(&quot;&quot;) + ylab(&quot;&quot;) +
    guides(color = guide_legend()) +
    coord_radar()
}

hg_gg_radar &lt;- function(df, group_col = 1, ...) {
  arglist &lt;- c(...)
  group &lt;- hg_get_colname(df, group_col)
  
  df &lt;- df %&gt;% gather(key = &quot;variable&quot;, value = &quot;value&quot;, -group) %&gt;%
    arrange(variable)
  hg_gg_radar_long(df, filter = arglist)
}

hg_df_rescale &lt;- function(df, ...) {
  arglist &lt;- list(...)
  if(length(arglist))
    df %&gt;% mutate_at(unlist(arglist), rescale)
  else
    df %&gt;% mutate_if(.predicate = is.numeric, rescale)
}

hg_gg_radar(df, &quot;姓名&quot;, &quot;C&quot;, &quot;D&quot;) +
  ggtitle(&quot;雷达图&quot;)</code></pre>
<p><img src="/post/2018-03-28-learn-to-make-a-radar-plot_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div class="section level1">
<h1>参考资料</h1>
<ul>
<li><a href="https://stackoverflow.com/questions/28898143/closing-the-lines-in-a-ggplot2-radar-spider-chart" class="uri">https://stackoverflow.com/questions/28898143/closing-the-lines-in-a-ggplot2-radar-spider-chart</a></li>
<li><a href="http://www.cmap.polytechnique.fr/~lepennec/R/Radar/RadarAndParallelPlots.html" class="uri">http://www.cmap.polytechnique.fr/~lepennec/R/Radar/RadarAndParallelPlots.html</a></li>
</ul>
</div>
