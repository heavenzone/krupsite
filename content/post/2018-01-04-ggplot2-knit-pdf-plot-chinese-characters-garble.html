---
title: ggplot2在knit中文pdf文档时图表中文字体乱码
author: Heaven Zone
date: '2018-01-04'
slug: ggplot2-knit-pdf-plot-chinese-characters-garble
categories:
  - R
tags:
  - R
  - ggplot2
  - knitr
---



<div class="section level2">
<h2>问题描述</h2>
<p>利用rmarkdown和knitr创建动态报告的确是非常酷，可是在使用的过程中发现在生成pdf的时候，图表中的中文字体没办法正常显示，在网上找了很久都没有找到好的解决办法，网上大多都是说使用showtext这个包，但是按照他们的办法却并没有解决我的问题。</p>
<p>直到昨天又翻开很久以前已经收藏的书签<a href="https://github.com/yihui/knitr/issues/799">yihui/knitr/issue/799</a>才算解决了这个问题，其实很久之前已经看过这个issue，可能当时不知道要安装showtext，所以没有才成功吧。</p>
<p>看问题：</p>
<pre class="r"><code>plot(pressure, main = &quot;中文标题&quot;)

ggplot(head(diamonds,100),aes(x, y)) +
  geom_point() +
  ggtitle(&quot;中文test&quot;) +
  xlab(&quot;中文2&quot;) +
  ylab(&quot;中文3&quot;)</code></pre>
<p><img src="/images/2018-01-04-noGB1-1.png" /> <img src="/images/2018-01-04-noGB1-2.png" /></p>
</div>
<div class="section level2">
<h2>解决办法</h2>
<div id="gb1" class="section level3">
<h3>方法一：使用GB1字体</h3>
<p>当然也不是完全没有办法，还是可以通过设置family来正常显示出中文（虽然会有很多warning出现），不过没办法设置其他字体,只能使用默认的<strong>GB1</strong>。</p>
<pre class="r"><code>plot(pressure, main = &quot;中文标题&quot;, family = &quot;GB1&quot;)</code></pre>
<p><img src="/post/2018-01-04-ggplot2-knit-pdf-plot-chinese-characters-garble_files/figure-html/withGB1-1.png" width="672" /></p>
<pre class="r"><code>ggplot(head(diamonds,100),aes(x, y)) +
  geom_point() +
  ggtitle(&quot;中文test&quot;) +
  xlab(&quot;中文2&quot;) +
  ylab(&quot;中文3&quot;) +
  theme(text = element_text(family = &quot;GB1&quot;))</code></pre>
<p><img src="/post/2018-01-04-ggplot2-knit-pdf-plot-chinese-characters-garble_files/figure-html/withGB1-2.png" width="672" /></p>
<p>这个办法只能用GB1字体，看了一些资料，貌似自己创建afm字体，或许可以使用自己想用的字体吧，但是这个方法有点难。可以看看这个<a href="https://www.stat.auckland.ac.nz/~paul/R/PDF/pdfEncoding.html">大神Paul</a>的文章。</p>
</div>
<div id="showtext" class="section level3">
<h3>方法二：使用showtext</h3>
<p>使用showtext也是很简单，只需要安装showtext，<code>install.packages(&quot;showtext&quot;)</code>，然后添加chunk的参数<code>fig.showtext=TRUE</code>就可以了。</p>
<pre class="r"><code>plot(pressure, main = &quot;中文标题&quot;)</code></pre>
<p><img src="/post/2018-01-04-ggplot2-knit-pdf-plot-chinese-characters-garble_files/figure-html/showtext-1.png" width="672" /></p>
<pre class="r"><code>ggplot(head(diamonds,100),aes(x, y)) +
  geom_point() +
  ggtitle(&quot;中文test&quot;) +
  xlab(&quot;中文2&quot;) +
  ylab(&quot;中文3&quot;)</code></pre>
<p><img src="/post/2018-01-04-ggplot2-knit-pdf-plot-chinese-characters-garble_files/figure-html/showtext-2.png" width="672" /></p>
<p>试试自定义字体</p>
<pre class="r"><code>library(showtext)
font.add(&quot;kaishu&quot;, &quot;simkai.ttf&quot;)
plot(pressure, main = &quot;中文标题&quot;, family = &quot;kaishu&quot;)</code></pre>
<p><img src="/post/2018-01-04-ggplot2-knit-pdf-plot-chinese-characters-garble_files/figure-html/font-1.png" width="672" /></p>
<pre class="r"><code>ggplot(head(diamonds,100),aes(x, y)) +
  geom_point() +
  ggtitle(&quot;中文test&quot;) +
  xlab(&quot;中文2&quot;) +
  ylab(&quot;中文3&quot;) +
  theme(text = element_text(family = &quot;kaishu&quot;))</code></pre>
<p><img src="/post/2018-01-04-ggplot2-knit-pdf-plot-chinese-characters-garble_files/figure-html/font-2.png" width="672" /></p>
</div>
<div id="showtext" class="section level3">
<h3>设置全局使用showtext</h3>
<p>在setup chunk中设置如下</p>
<pre><code>knitr::opts_chunk$set(fig.showtext=TRUE)</code></pre>
</div>
</div>
<div class="section level2">
<h2>疑问</h2>
<p>本页并没有任何设置字体大小的代码，但是发现最后几张图表的字体太小了。</p>
</div>
<div class="section level2">
<h2>参考资料</h2>
<ul>
<li><a href="https://github.com/yihui/knitr/issues/799" class="uri">https://github.com/yihui/knitr/issues/799</a></li>
<li><a href="https://www.stat.auckland.ac.nz/~paul/R/PDF/pdfEncoding.html" class="uri">https://www.stat.auckland.ac.nz/~paul/R/PDF/pdfEncoding.html</a></li>
</ul>
</div>
